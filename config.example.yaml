# ethpandaops MCP Server Configuration
# Copy this file to config.yaml and customize for your environment.
# Environment variables can be substituted using ${VAR_NAME} syntax.

server:
  host: "0.0.0.0"
  port: 2480
  base_url: "http://localhost:2480"

# Plugin configuration
# Each key maps to a compiled-in plugin. Plugins without config are skipped.
# Datasource availability is discovered from the credential proxy; plugin config is for
# schema discovery, documentation, and optional overrides.
plugins:
  # ClickHouse configuration
  # Schema discovery runs THROUGH the credential proxy (no direct DB creds here).
  # Datasource names must match proxy-config.yaml.
  clickhouse:
    # ClickHouse schema discovery configuration
    # Discovers table schemas from proxy-exposed datasources.
    schema_discovery:
      # enabled: true  # Optional; defaults to enabled when proxy has datasources
      refresh_interval: 15m  # How often to refresh schema cache

      # Datasources to discover schemas from.
      # If empty or omitted, ALL proxy ClickHouse datasources are used.
      datasources:
        - name: "xatu"      # Proxy datasource name
          cluster: "xatu"   # Logical cluster name for resources (defaults to name)
        - name: "xatu-cbt"
        - name: "xatu-experimental"
          cluster: "xatu-experimental"

  # Dora configuration
  # Dora beacon chain explorer is enabled by default with no configuration needed.
  # Network URLs are discovered automatically from cartographoor.
  # dora:
  #   enabled: true  # Set to false to disable Dora integration


# Sandbox configuration
sandbox:
  # Backend: docker (local dev) | gvisor (production)
  backend: docker
  image: "ethpandaops-mcp-sandbox:latest"
  timeout: 60  # seconds
  memory_limit: "2g"
  cpu_limit: 1.0
  # Network for sandbox containers. In stdio mode (outside docker-compose),
  # the server auto-creates this network if it doesn't exist.
  network: "ethpandaops-mcp-internal"
  # host_shared_path: "/tmp/mcp-sandbox"  # Docker-in-Docker: host-visible path for bind mounts

  # Sessions configuration (optional)
  # When enabled, sandbox containers persist between calls (enabled by default)
  # sessions:
  #   enabled: true
  #   ttl: 30m          # idle timeout (default: 30m)
  #   max_duration: 4h  # absolute max session lifetime (default: 4h)
  #   max_sessions: 10  # max concurrent sessions (default: 10)

# S3-compatible storage for output files
# IMPORTANT: The endpoint must be reachable from sandbox containers (on the sandbox network),
# not from the host. Use Docker service names (e.g., http://minio:9000), not localhost URLs.
storage:
  endpoint: "${S3_ENDPOINT}"  # e.g., http://minio:9000 or https://xxx.r2.cloudflarestorage.com
  access_key: "${S3_ACCESS_KEY}"
  secret_key: "${S3_SECRET_KEY}"
  bucket: "ethpandaops-mcp-outputs"
  region: "us-east-1"
  public_url_prefix: "${S3_PUBLIC_URL}"  # e.g., https://outputs.example.com

# Authentication configuration
# When enabled, requires GitHub OAuth for HTTP transports (SSE, streamable-http).
# Stdio transport (local/Claude Desktop) never requires auth.
auth:
  enabled: false  # Set to true to require authentication

  # GitHub OAuth configuration (required when auth.enabled is true)
  # github:
  #   client_id: "${GITHUB_CLIENT_ID}"
  #   client_secret: "${GITHUB_CLIENT_SECRET}"

  # Organizations allowed to access the server (empty = all authenticated users)
  # allowed_orgs:
  #   - "ethpandaops"

  # JWT token configuration
  # tokens:
  #   secret_key: "${JWT_SECRET_KEY}"  # Required when auth is enabled

# Proxy connection configuration
# The MCP server connects to a separate proxy server that holds datasource credentials.
# Start the proxy first: mcp proxy -c proxy-config.yaml
# Or connect to a remote K8s-hosted proxy.
proxy:
  url: "http://localhost:18081"  # Proxy server URL (default)

  # Auth configuration (optional, for K8s deployments with JWT auth)
  # Users must run 'mcp auth login' first to obtain a JWT.
  # auth:
  #   issuer_url: "https://dex.ethpandaops.io"
  #   client_id: "ethpandaops-mcp"

# Observability configuration
observability:
  metrics_enabled: true
  metrics_port: 31490

# Semantic search configuration (required).
# Ensure the model file exists at the configured path.
# semantic_search:
#   model_path: "models/MiniLM-L6-v2.Q8_0.gguf"  # Local dev default; in Docker image it's /usr/share/mcp/...
#   gpu_layers: 0                               # Layers to offload to GPU (0 = CPU only)
