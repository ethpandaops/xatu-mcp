# Multi-step test cases for xatu-mcp evaluation
# These test multi-turn conversations with session persistence

- id: session_data_analysis
  description: Multi-turn data analysis with session persistence
  network: mainnet
  tags:
    - multi_step
    - session
    - analysis
  steps:
    - prompt: "Query the last 1000 blocks on mainnet and save the data to a CSV file."
      expected_tools:
        - mcp__xatu__execute_python
      expect_session_id: true
      metrics:
        task_completion: 0.7

    - prompt: "Now load that CSV and calculate the average gas used per block."
      use_previous_session: true
      expected_tools:
        - mcp__xatu__execute_python
      metrics:
        task_completion: 0.8

    - prompt: "Create a histogram of gas usage from the data."
      use_previous_session: true
      expected_tools:
        - mcp__xatu__execute_python
      metrics:
        visualization_url: 0.8

- id: block_timing_analysis
  description: Detailed block timing analysis workflow
  network: mainnet
  tags:
    - multi_step
    - timing
    - analysis
  steps:
    - prompt: "Query block arrival times for the last 10000 slots on mainnet."
      expected_tools:
        - mcp__xatu__execute_python
      expect_session_id: true
      metrics:
        task_completion: 0.7
      expected_tables:
        - libp2p_gossipsub_beacon_block
        - fct_block_first_seen_by_node
        - beacon_api_eth_v1_events_block
      expected_datasource: clickhouse
      require_all_tables: false  # Either table is acceptable

    - prompt: "Group the data by observer consensus client and calculate the mean and p95 arrival time for each."
      use_previous_session: true
      expected_tools:
        - mcp__xatu__execute_python
      metrics:
        task_completion: 0.8

    - prompt: "Create a box plot comparing the arrival time distributions across clients."
      use_previous_session: true
      expected_tools:
        - mcp__xatu__execute_python
      metrics:
        visualization_url: 0.8
