# Example configuration for the ethpandaops proxy server.
# The proxy holds datasource credentials and proxies requests from sandbox containers.
#
# Usage:
#   Local dev:  mcp proxy -c proxy-config.yaml
#   Production: Deploy as a K8s service
#
# The MCP server connects to this proxy via its 'proxy.url' config.

server:
  # Address to listen on
  listen_addr: ":18081"

  # HTTP timeouts
  read_timeout: 30s
  write_timeout: 5m
  idle_timeout: 60s

auth:
  # Authentication mode:
  # - "none": No authentication (for local development only - DEFAULT)
  # - "token": Local per-execution tokens
  # - "jwt": JWT validation against JWKS endpoint (for production K8s deployments)
  mode: none  # Use 'jwt' for production

  # Token TTL (only used when mode is "token")
  # token_ttl: 1h

  # JWT configuration (only used when mode is "jwt")
  # jwt:
  #   # JWKS URL for JWT validation (e.g., from Dex)
  #   jwks_url: "${DEX_JWKS_URL}"
  #
  #   # Expected token issuer
  #   issuer: "${DEX_ISSUER_URL}"
  #
  #   # Expected token audience (optional)
  #   audience: "ethpandaops-proxy"
  #
  #   # Allowed GitHub organizations
  #   # Users must be members of at least one of these orgs
  #   allowed_orgs:
  #     - ethpandaops
  #     - sigp
  #
  #   # How often to refresh the JWKS cache
  #   refresh_interval: 1h

# ClickHouse clusters
clickhouse:
  - name: xatu
    host: "${CLICKHOUSE_HOST}"
    port: 8443
    database: default
    username: "${CLICKHOUSE_USERNAME}"
    password: "${CLICKHOUSE_PASSWORD}"
    secure: true
    skip_verify: false
    timeout: 300

# Prometheus instances
prometheus:
  - name: primary
    url: "${PROMETHEUS_URL}"
    username: "${PROMETHEUS_USERNAME}"
    password: "${PROMETHEUS_PASSWORD}"

# Loki instances
loki:
  - name: primary
    url: "${LOKI_URL}"
    username: "${LOKI_USERNAME}"
    password: "${LOKI_PASSWORD}"

# S3 storage for file uploads
s3:
  endpoint: "${S3_ENDPOINT}"
  access_key: "${S3_ACCESS_KEY}"
  secret_key: "${S3_SECRET_KEY}"
  bucket: "ethpandaops-mcp-outputs"
  region: "us-east-1"
  public_url_prefix: "${S3_PUBLIC_URL_PREFIX}"

# Rate limiting
rate_limiting:
  enabled: true
  requests_per_minute: 60
  burst_size: 10

# Audit logging
audit:
  enabled: true
  log_queries: true
  max_query_length: 500
